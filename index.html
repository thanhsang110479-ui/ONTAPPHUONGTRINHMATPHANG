<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ÔN TẬP NGUYÊN HÀM - TẠO BỞI MR SANG</title>
<style>
  :root {
    --bg1:#1f3243;
    --bg2:#22435c;
    --card:rgba(255,255,255,.08);
    --line:rgba(255,255,255,.14);
    --text:#eaf4ff;
    --muted:rgba(234,244,255,.78);
    --green:#19c37d;
    --orange:#ff8a00;
    --orange2:#ffb14a;
    --bad:#ff4d4f;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    color:var(--text);
    background:
      radial-gradient(900px 500px at 15% 0%, rgba(25,195,125,.35), transparent 55%),
      radial-gradient(900px 520px at 85% 10%, rgba(255,138,0,.35), transparent 55%),
      linear-gradient(180deg, var(--bg2), var(--bg1));
    min-height:100vh;
  }
  .wrap{max-width:980px;margin:0 auto;padding:18px 14px 28px}
  .topbar{
    display:flex;align-items:center;justify-content:space-between;gap:12px;
    padding:14px 16px;border:1px solid var(--line);border-radius:18px;
    background:linear-gradient(135deg, rgba(0,120,255,.95), rgba(0,180,255,.95));
    box-shadow:0 14px 40px rgba(0,0,0,.25);
  }
  /* Topbar blue + white text (only this area) */
  .topbar .title h1,
  .topbar .sub,
  .topbar .pill{ color:#ffffff !important; }
  .topbar .pill{
    border-color: rgba(255,255,255,.35) !important;
    background: rgba(255,255,255,.18) !important;
  }

  /* Title text on orange topbar only */
  .topbar .title h1, .topbar .title .sub{color:#0b2a6a;}

  .title{display:flex;flex-direction:column;gap:4px}
  .title h1{margin:0;font-size:18px;letter-spacing:.2px}
  .title .sub{font-size:12px;color:var(--muted)}
  .pill{
    font-size:12px;border:1px solid var(--line);border-radius:999px;
    padding:8px 10px;background:rgba(0,0,0,.15);color:var(--muted);
    white-space:nowrap;
  }
  .grid{display:grid;grid-template-columns:1fr;gap:14px;margin-top:14px}
  @media (max-width: 900px){ .grid{grid-template-columns:1fr} }
  .card{
    border:1px solid var(--line);border-radius:18px;padding:16px;
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    box-shadow:0 14px 40px rgba(0,0,0,.25);
  }
  .btn{
    border:1px solid rgba(255,255,255,.18);
    border-radius:14px;padding:10px 12px;
    background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.02));
    color:var(--text);cursor:pointer;transition:.12s transform, .12s filter;
    user-select:none;
  }
  .btn:hover{transform:translateY(-1px);filter:brightness(1.06)}
  .btn:disabled{opacity:.55;cursor:not-allowed;transform:none;filter:none}
  .btn.primary{
    border-color: rgba(25,195,125,.55);
    box-shadow: 0 0 0 2px rgba(25,195,125,.12) inset;
  }
  .btn.orange{
    border-color: rgba(255,138,0,.65);
    box-shadow: 0 0 0 2px rgba(255,138,0,.12) inset;
  }
  .btn.ghost{background:rgba(0,0,0,.10)}
  .btn.exit{
    background: linear-gradient(180deg, rgba(255,255,255,.22), rgba(255,255,255,.06)), #ff3b30;
    border-color: rgba(255,59,48,.95);
    box-shadow: 0 0 0 2px rgba(255,59,48,.18) inset;
    color:#fff;
    font-weight:800;
  }
  .btn.exit:hover{filter:brightness(1.05)}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .muted{color:var(--muted);font-size:13px;line-height:1.5}
  .sep{height:1px;background:rgba(255,255,255,.12);margin:12px 0}
  .stats{display:grid;grid-template-columns:1fr;gap:10px}
  .stat{border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:10px;background:rgba(0,0,0,.14)}
  .stat .k{font-size:12px;color:var(--muted)}
  .stat .v{font-size:18px;font-weight:800;margin-top:4px}
  .screen{display:none}
  .screen.active{display:block}
  .qhead{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:center}
  .qleft{display:flex;align-items:center;gap:10px;flex-wrap:wrap}

  .qnum{font-weight:800;font-size:22px}
  .timer{font-variant-numeric:tabular-nums;font-size:20px}
  .bar{height:10px;border-radius:999px;background:rgba(255,255,255,.10);overflow:hidden;border:1px solid rgba(255,255,255,.12)}
  .bar > div{height:100%;width:100%;background:linear-gradient(90deg, var(--green), var(--orange))}
  .qtext{margin-top:12px;font-size:22px;line-height:1.6;color:#fff}
  .qtext, .qtext *{color:#fff !important}
  .choice, .choice *{color:#fff !important}
  .choice b{color:var(--orange2) !important}

  .qtext img{max-height:122px;vertical-align:middle;filter:invert(1) brightness(1.9) contrast(2.2);image-rendering:-webkit-optimize-contrast;transform:translateZ(0);}
.choices img{max-height:112px;vertical-align:middle;filter:invert(1) brightness(1.9) contrast(2.2);image-rendering:-webkit-optimize-contrast;transform:translateZ(0);}
  .choices{display:grid;gap:10px;margin-top:12px}
  .choice{
    text-align:left;padding:16px 14px;border-radius:18px;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(0,0,0,.12);
    font-size:20px;line-height:1.4;
  }
  .choice:hover{border-color: rgba(255,177,74,.70)}
  .choice.correct{border-color: rgba(25,195,125,.85); box-shadow: 0 0 0 2px rgba(25,195,125,.12) inset;}
  .choice.wrong{border-color: rgba(255,77,79,.85); box-shadow: 0 0 0 2px rgba(255,77,79,.12) inset;}
  .choice.disabled{pointer-events:none;opacity:.95}
  .toast{margin-top:10px;font-size:14px}
  .toast.good{color:var(--green)}
  .toast.bad{color:var(--bad)}
  .footer{text-align:center;margin-top:14px;color:rgba(234,244,255,.65);font-size:12px}

  /* Player form */
  .formGrid{display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin:14px 0 6px;}
  @media (max-width:700px){ .formGrid{grid-template-columns:1fr;} }
  .field label{display:block; font-size:13px; color:var(--muted); margin:0 0 6px; font-weight:600;}
  input.text{
    width:100%;
    padding:12px 12px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.18);
    background: rgba(0,0,0,.12);
    color: var(--text);
    outline:none;
    font-size:16px;
  }
  input.text:focus{border-color: rgba(255,138,0,.7); box-shadow:0 0 0 2px rgba(255,138,0,.12) inset;}
  .warn{margin-top:8px; color:#ffd166; font-size:13px;}


  .qright{display:flex;align-items:center;gap:10px}
</style>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>


  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true
      },
      options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'] }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
<div class="wrap">
  <div class="topbar">
    <div class="title">
      <h1>ÔN TẬP NGUYÊN HÀM</h1>
      <div class="sub">TẠO BỞI MR SANG</div>
    </div>
    <div class="pill">20 câu / lượt • 30 giây / câu</div>
  </div>

  <div class="grid">
    <div class="card">
      <div class="screen active" id="screenStart">
        <audio id="introAudio" preload="auto" playsinline></audio>
        <div class="muted">
          Nhấn <b>Bắt đầu</b> để chơi. Mỗi lượt gồm <b>20 câu</b> lấy ngẫu nhiên từ kho. Mỗi câu có <b>30 giây</b>.
        </div>
        <div class="sep"></div>

        <div class="formGrid">
          <div class="field">
            <label for="playerName">Họ và tên</label>
            <input class="text" id="playerName" name="mr_sang_player_name" type="text" placeholder="Nhập họ và tên..." autocomplete="off" />
          </div>
          <div class="field">
            <label for="playerClass">Lớp</label>
            <input class="text" id="playerClass" name="mr_sang_player_class" type="text" placeholder="Ví dụ: 12A1" autocomplete="off" />
          </div>
        </div>
        <div class="warn" id="playerWarn" style="display:none">Vui lòng nhập đầy đủ <b>Họ và tên</b> và <b>Lớp</b> để bắt đầu.</div>
        <div class="row">
          <button class="btn primary" id="btnStart">Bắt đầu</button>
          <button class="btn ghost" id="btnHow">Hướng dẫn</button>
        </div>
        <div class="toast muted" id="howText" style="display:none"></div>
      </div>

      <div class="screen" id="screenGame">
        <div class="qhead">
          <div class="qleft"><div class="qnum" id="qNum">Câu 1/20</div><button class="btn exit" id="btnExit" type="button">Thoát</button></div>
<div class="qright"><div class="timer" id="qTimer">00:30</div></div></div>
        <div class="bar"><div id="timeBar"></div></div>

        <div class="qtext" id="qText"></div>
        <div class="choices" id="choices"></div>

        <div class="toast" id="toast"></div>

        <div class="sep"></div>
        <div class="row">
          <button class="btn ghost" id="btnPrev" disabled>← Câu trước</button>
          <button class="btn orange" id="btnNext" disabled>Câu tiếp →</button>
          <button class="btn ghost" id="btnExitReview" style="display:none">↩ Trở lại kết quả</button>
          <span class="muted" id="navHint">Chọn đáp án để mở nút “Câu tiếp”.</span>
        </div>
      </div>

      <div class="screen" id="screenResult">
        <div class="qhead">
          <div class="qnum">Hoàn thành!</div>
          <div class="pill" id="resultTime">—</div>
        </div>
        <div class="sep"></div>
        <div class="stats">
          <div class="stat"><div class="k">Số câu đúng</div><div class="v" id="rGood">0</div></div>
          <div class="stat"><div class="k">Số câu sai</div><div class="v" id="rBad">0</div></div>
          <div class="stat"><div class="k">Điểm (10)</div><div class="v" id="rScore">0</div></div>
        </div>
        <div class="sep"></div>
        <div class="row">
          <button class="btn primary" id="btnReplay">Chơi lượt mới</button>
          <button class="btn orange" id="btnExport">Tải Excel kết quả</button>
          <button class="btn ghost" id="btnReview">Xem lại</button>
        </div>
        <div class="toast muted" id="exportNote">Nhấn <b>Tải Excel kết quả</b> để tải file gửi giáo viên.</div>
        <div class="toast muted" id="reviewNote" style="display:none">
          Chế độ xem lại chỉ hiển thị câu + đáp án đã chọn và đánh dấu đúng/sai.
        </div>
      </div>

      <div class="footer">© ÔN TẬP NGUYÊN HÀM - TẠO BỞI MR SANG</div>
    </div>

    <div class="card">
      <div class="muted"><b>Thống kê lượt chơi</b></div>
      <div class="sep"></div>
      <div class="stats">
        <div class="stat"><div class="k">Tiến độ</div><div class="v" id="sProg">0/20</div></div>
        <div class="stat"><div class="k">Đúng</div><div class="v" id="sGood">0</div></div>
        <div class="stat"><div class="k">Sai</div><div class="v" id="sBad">0</div></div>
      </div>
      <div class="sep"></div>
      <div class="muted">
        <b>Mẹo</b><br/>
        • Nếu hết thời gian mà chưa chọn, hệ thống tính là <b>sai</b> và chuyển câu tiếp theo.<br/>
        • Có thể quay lại câu trước để xem lại, nhưng không đổi đáp án sau khi đã chấm.
      </div>
      <div class="sep"></div>
      <div class="row">
        <button class="btn ghost" id="btnStop" disabled>Kết thúc sớm</button>
        <button class="btn ghost" id="btnMute">Tắt âm</button>
      </div>
    </div>
  </div>
</div>

<script>
const BANK = [{"id": 1, "q": "Cho hàm số $y=f\\left( x \\right)$ là một nguyên hàm của hàm số $y={{x}^{7}}$. Phát biểu nào sau đây đúng?", "A": "$f\\left( x \\right)=8{{x}^{7}}$.", "B": "$f\\left( x \\right)=7{{x}^{6}}$.", "C": "$f\\left( x \\right)=\\dfrac{{{x}^{8}}}{7}+C$.", "D": "$f\\left( x \\right)=\\dfrac{{{x}^{8}}}{8}+C$.", "correct": "D"}, {"id": 2, "q": "Họ nguyên hàm của hàm số $f\\left( x \\right)=-2\\sin x+6x$ là?", "A": "$2\\cos x+3x^2+C$.", "B": "$2\\sin x+3x^2+C$.", "C": "$-2\\cos x+3x^2+C$.", "D": "$-2\\sin x+6x^2+C$.", "correct": "A"}, {"id": 3, "q": "Họ nguyên hàm của hàm số $f\\left( x \\right)=6\\cos x+x$ là?", "A": "$-6\\sin x+\\dfrac{1}{2}x^2+C$.", "B": "$6\\cos x+\\dfrac{1}{2}x^2+C$.", "C": "$6\\sin x+\\dfrac{1}{2}x^2+C$.", "D": "$-6\\cos x+\\dfrac{1}{2}x^2+C$.", "correct": "C"}, {"id": 4, "q": "Họ nguyên hàm của hàm số $f\\left( x \\right)=7e^x+7$ là?", "A": "$7e^x+7x+C$.", "B": "$7e^x+7+C$.", "C": "$-7e^x+\\dfrac{7}{2}x+C$.", "D": "$\\dfrac{7}{2}e^x+\\dfrac{7}{2}x+C$.", "correct": "A"}, {"id": 5, "q": "Tìm $\\int{\\left(-4x^5-x+3 \\right)\\text{d}x}$", "A": "$-16x^4-1+C$.", "B": "$-\\dfrac{4}{5}x^5-\\dfrac{1}{2}x^2+3x+C$.", "C": "$-\\dfrac{2}{3}x^6-\\dfrac{1}{2}x^2+3x+C$.", "D": "$-24x^6-2x^2+3x+C$.", "correct": "C"}, {"id": 6, "q": "Trên khoảng $(0;+\\infty)$, họ nguyên hàm của hàm số $f(x)=x^{\\frac{5}{2}}$ là", "A": "$\\int f(x)\\text{d}x=\\dfrac{5}{2}x^{\\frac{3}{2}}+C$.", "B": "$\\int f(x)\\text{d}x=\\dfrac{2}{7}x^{\\frac{7}{2}}+C$.", "C": "$\\int f(x)\\text{d}x=\\dfrac{2}{5}x^{\\frac{3}{2}}+C$.", "D": "$\\int f(x)\\text{d}x=\\dfrac{7}{2}x^{\\frac{7}{2}}+C$.", "correct": "B"}, {"id": 7, "q": "Trên khoảng $(0;+\\infty)$, họ nguyên hàm của hàm số $f(x)=\\dfrac{-2}{x^{18}}$ là", "A": "$\\int f(x)\\text{d}x=\\dfrac{-2}{-18x^{17}}+C$.", "B": "$\\int f(x)\\text{d}x=\\dfrac{-2}{17x^{17}}+C$.", "C": "$\\int f(x)\\text{d}x=\\dfrac{-2}{-17x^{17}}+C$.", "D": "$\\int f(x)\\text{d}x=\\dfrac{34}{x^{17}}+C$.", "correct": "C"}, {"id": 8, "q": "Tìm $\\int{\\left(\\dfrac{-4}{x^4}+\\dfrac{7}{x}-2 \\right)\\text{d}x}$", "A": "$\\dfrac{4}{5}\\dfrac{1}{x^5}+7\\ln x-2x+C$.", "B": "$\\dfrac{4}{3}\\dfrac{1}{x^3}+7\\ln x-2x+C$.", "C": "$12\\dfrac{1}{x^3}+7\\ln|x|-2x+C$.", "D": "$\\dfrac{4}{3}\\dfrac{1}{x^3}+7\\ln|x|-2x+C$.", "correct": "D"}, {"id": 9, "q": "Tìm $\\int{e^{8x+3}\\text{d}x}$", "A": "$8.e^{8x+3}+C$.", "B": "$\\dfrac{e^{8x+3}}{9}+C$.", "C": "$\\dfrac{e^{8x+3}}{8}+C$.", "D": "$7.e^{8x+3}+C$.", "correct": "C"}, {"id": 10, "q": "Tìm $\\int{\\dfrac{2x^3-x^{2}+7}{x^{3}}\\text{d}x}$", "A": "$-14\\dfrac{1}{x^2}-\\ln|x|+2x+C$.", "B": "$-\\dfrac{7}{2}\\dfrac{1}{x^2}-\\ln|x|+2x+C$.", "C": "$-\\dfrac{7}{2}\\dfrac{1}{x^2}-\\ln x+2x+C$.", "D": "$-\\dfrac{7}{4}\\dfrac{1}{x^4}-\\ln x+2x+C$.", "correct": "B"}, {"id": 11, "q": "$f(x)=-x^8+3\\sin x-2\\ln |x|+1$ là một nguyên hàm của hàm số nào?", "A": "$-\\dfrac{1}{9}x^9-3\\cos x-\\dfrac{2}{x}$.", "B": "$-8x^7-3\\cos x-\\dfrac{2}{x}$.", "C": "$-8x^7+3\\cos x-\\dfrac{2}{x}$.", "D": "$-\\dfrac{1}{9}x^9-3\\cos x-\\dfrac{2}{x}+x+C$.", "correct": "C"}, {"id": 12, "q": "Tìm $\\int{\\left(3e^{-4x}+3.5^x-4 \\right)\\text{d}x}$", "A": "$-\\dfrac{3}{4}e^{-4x}+3.5^x -4x+C$.", "B": "$-\\dfrac{3}{4}e^{-4x}+\\dfrac{3.5^x}{\\ln 5} -4x+C$.", "C": "$3e^{-4x}+\\dfrac{3.5^x}{\\ln 5} +C$.", "D": "$3e^{-4x}+3.5^x -4x+C$.", "correct": "B"}, {"id": 13, "q": "Tìm $\\int{\\left(10\\sin x+9\\cos x+4 \\right)\\text{d}x}$", "A": "$10\\cos x-9\\sin x+4x+C$.", "B": "$10\\cos x+9\\sin x+4x+C$.", "C": "$-10\\cos x-9\\sin x+4x+C$.", "D": "$-10\\cos x+9\\sin x+4x+C$.", "correct": "D"}, {"id": 14, "q": "Tìm $\\int{\\left(4\\sin x+8\\cos x+2x+4 \\right)\\text{d}x}$", "A": "$-4\\cos x-8\\sin x+4x^2+4x+C$.", "B": "$4\\cos x+8\\sin x+2x^2+4x+C$.", "C": "$-4\\cos x+8\\sin x+x^2+4x+C$.", "D": "$4\\cos x-8\\sin x+x^2+4x+C$.", "correct": "C"}, {"id": 15, "q": "Tìm $\\int{\\left(-3\\sin 2x+6\\cos 9x+4 \\right)\\text{d}x}$", "A": "$6\\sin 2x+54\\cos 9x+4x+C$.", "B": "$\\dfrac{3}{2}\\cos 2x+\\dfrac{2}{3}\\sin 9x+4x+C$.", "C": "$-6\\cos 2x+54\\sin 9x+4x+C$.", "D": "$-\\dfrac{3}{2}\\sin 2x-\\dfrac{2}{3}\\cos 9x+4x+C$.", "correct": "B"}, {"id": 16, "q": "Tìm $\\int{1(9x+10)^8\\text{d}x}$", "A": "$\\dfrac{1}{8}(9x+10)^9+C$.", "B": "$\\dfrac{1}{9}(9x+10)^9+C$.", "C": "$\\dfrac{1}{81}(9x+10)^9+C$.", "D": "$\\dfrac{1}{72}(9x+10)^9+C$.", "correct": "C"}, {"id": 17, "q": "Tìm $\\int{\\dfrac{-4}{(-x+8)^4}\\text{d}x}$", "A": "$\\dfrac{4}{3}\\dfrac{1}{(-x+8)^3}+C$.", "B": "$-\\dfrac{4}{3}\\dfrac{1}{(-x+8)^5}+C$.", "C": "$-\\dfrac{4}{3}\\dfrac{1}{(-x+8)^3}+C$.", "D": "$\\dfrac{4}{3}\\dfrac{1}{(-x+8)^5}+C$.", "correct": "C"}, {"id": 18, "q": "Tìm $\\int{\\dfrac{3}{2x-1}\\text{d}x}$", "A": "$\\dfrac{3}{2}\\ln |2x-1|+C$.", "B": "$3\\ln (2x-1)+C$.", "C": "$\\dfrac{3}{2}\\ln (2x-1)+C$.", "D": "$3\\ln |2x-1|+C$.", "correct": "A"}, {"id": 19, "q": "Tìm $\\int{-3\\sin 10x.\\sin 9x\\text{d}x}$", "A": "$\\dfrac{3}{2}\\cos x+\\dfrac{3}{2}\\cos 19x+C$.", "B": "$\\dfrac{3}{2}\\sin x+\\dfrac{3}{38}\\sin 19x+C$.", "C": "$-\\dfrac{3}{2}\\sin x+\\dfrac{3}{38}\\sin 19x+C$.", "D": "$3\\cos x+\\dfrac{3}{19}\\cos 19x+C$.", "correct": "C"}, {"id": 20, "q": "Biết $F(x)=\\int{\\left(8x^2+x+4 \\right)\\text{d}x}$ và $F(1)=1$. Tìm $F(x)$", "A": "$4x^2+\\dfrac{1}{2}x^2+4x+\\dfrac{43}{6}$.", "B": "$\\dfrac{8}{3}x^3+\\dfrac{1}{2}x^2+4x-\\dfrac{37}{6}$.", "C": "$16x-\\dfrac{40}{3}$.", "D": "$24x^3+2x^2+4x+\\dfrac{43}{3}$.", "correct": "B"}, {"id": 21, "q": "Tìm $\\int{f'(x)\\text{d}x}$. Biết $f(x)=x^5+8x+6$", "A": "$x^5+8x+C$.", "B": "$5x^4+C$.", "C": "$\\dfrac{1}{6}x^6+4x^2+6x+C$.", "D": "$\\dfrac{1}{5}x^5+4x^2+6x+C$.", "correct": "A"}, {"id": 22, "q": "Biết $\\int{(-5x+8).e^{x}\\text{d}x}=(ax+b)e^x+C$. Tính $a+2b$", "A": "$24$.", "B": "$20$.", "C": "$21$.", "D": "$19$.", "correct": "C"}, {"id": 23, "q": "Biết $\\int{(3x^2+5x).e^{x}\\text{d}x}=(ax^2+bx+c)e^x+C$. Tính $a+b+c$", "A": "$5$.", "B": "$3$.", "C": "$2$.", "D": "$0$.", "correct": "B"}, {"id": 24, "q": "Biết $F(x)=(a\\sin x+b\\cos x)e^x$ là một nguyên hàm của hàm số $f(x)=(3\\sin x+4\\cos x)e^x$. Tính $a+b$.", "A": "$4$.", "B": "$3$.", "C": "$1$.", "D": "$6$.", "correct": "A"}, {"id": 25, "q": "Hàm số $F(x)=5 x^3+4 x^2-7 x+120$ là một nguyên hàm của hàm số nào sau đây?", "A": "$f(x)=5 x^2+4 x-7$.", "B": "$f(x)=\\dfrac{5 x^2}{4}+\\dfrac{4 x^3}{3}-\\dfrac{7 x^2}{2}$.", "C": "$f(x)=15 x^2+8 x-7$.", "D": "$f(x)=5 x^2+4 x+7$.", "correct": "C"}, {"id": 26, "q": "Họ tất cả các nguyên hàm của hàm số $y=\\mathrm{e}^x+\\cos x$ là", "A": "$-\\mathrm{e}^x+\\sin x+C$.", "B": "$\\mathrm{e}^x+\\sin x+C$.", "C": "$-\\mathrm{e}^x-\\sin x+C$.", "D": "$\\mathrm{e}^x-\\sin x+C$.", "correct": "B"}, {"id": 27, "q": "Họ tất cả các nguyên hàm của hàm số $f(x)=\\dfrac{2}{4 x-3}$ trên khoảng $(1 ;+\\infty)$ là", "A": "$2 \\ln (4 x-3)+C$.", "B": "$\\dfrac{1}{2} \\ln (4 x-3)+C$.", "C": "$\\dfrac{1}{4} \\ln (4 x-3)+C$.", "D": "$4 \\ln (4 x-3)+C$.", "correct": "B"}, {"id": 28, "q": "Họ các nguyên hàm của hàm số $f(x)=5x^4-6x^2+1$ là", "A": "$20x^5-12x+x+C$.", "B": "$20x^3-11x+C$.", "C": "$\\dfrac{x^4}{4}+2x^3-2x+C$.", "D": "$x^5-2x^3+x+C$.", "correct": "D"}, {"id": 29, "q": "Họ các nguyên hàm $\\int \\limits(2x+\\cos x) \\mathrm{d}x$ là", "A": "$x^2-\\sin x+C$.", "B": "$2x^2+\\sin x+C$.", "C": "$2x^2-\\sin x+C$.", "D": "$x^2+\\sin x+C$.", "correct": "D"}, {"id": 30, "q": "Họ nguyên hàm của hàm số $f(x)=3 \\sin x$ là", "A": "$3 \\cos 2 x+C$.", "B": "$-3 \\sin x+C$.", "C": "$-3 \\cos x+C$.", "D": "$3 \\cos x+C$.", "correct": "C"}, {"id": 31, "q": "Họ nguyên hàm của hàm số $f( x )=\\dfrac{1}{x-1}$ là", "A": "$x-\\dfrac{2}{x-1}+C$.", "B": "$-\\dfrac{1}{( x-1 )^2}+C$.", "C": "$\\ln |x-1|+C$.", "D": "$\\ln (x-1)+C$.", "correct": "C"}, {"id": 32, "q": "$\\displaystyle\\int\\dfrac{1}{\\sin ^2 x} \\mathrm{d}x$ bằng", "A": "$\\cot x+C$.", "B": "$\\tan x+C$.", "C": "$-\\cot x+C$.", "D": "$-\\tan x+C$.", "correct": "C"}, {"id": 33, "q": "Tìm họ nguyên hàm của hàm số $f\\left( x \\right)=1-2\\sin x$.", "A": "$\\displaystyle\\int{\\left( 1-2\\sin x \\right)\\mathrm{d}x}=-2\\cos x+C$.", "B": "$\\displaystyle\\int{\\left( 1-2\\sin x \\right)\\mathrm{d}x}=x-2\\cos x+C$.", "C": "$\\displaystyle\\int{\\left( 1-2\\sin x \\right)\\mathrm{d}x}=x+2\\cos x+C$.", "D": "$\\displaystyle\\int{\\left( 1-2\\sin x \\right)\\mathrm{d}x}=1+2\\cos x+C$.", "correct": "C"}, {"id": 34, "q": "$\\displaystyle\\int e^tx \\mathrm{d}x$, ($t$ là hằng số) bằng", "A": "$e^t+C$.", "B": "$e^t\\left(x+1\\right)+C$.", "C": "$\\dfrac{e^t}{2}x^2+C$.", "D": "$2e^tx^2+C$.", "correct": "C"}, {"id": 35, "q": "Họ các nguyên hàm $\\displaystyle\\int{\\left( {x^2}-2 \\right)\\mathrm{d}x}$ bằng", "A": "$\\dfrac{1}{3}{x^3}-2x+C$.", "B": "$\\dfrac{1}{3}{x^3}+C$.", "C": "$2x+C$.", "D": "$3x^3-2x+C$.", "correct": "A"}, {"id": 36, "q": "Khẳng định nào sau đây là sai?", "A": "$\\displaystyle\\int \\cos x\\mathrm{d}x=\\sin x+C$.", "B": "$\\displaystyle\\int \\dfrac {1}{x}\\mathrm{d}x=\\ln x+C$.", "C": "$\\displaystyle\\int x\\mathrm{d}x =\\dfrac {1}{2}x^2+C$.", "D": "$\\displaystyle\\int \\mathrm{e}^{2x}\\mathrm{d}x=\\dfrac {1}{2}\\mathrm{e}^{2x}+C$.", "correct": "B"}, {"id": 37, "q": "Nguyên hàm của hàm số $f(x)=\\sin 3 x$ là", "A": "$-3\\cos3x+C$.", "B": "$\\dfrac{\\cos 3 x}{3}+C$.", "C": "$-\\dfrac{\\cos 3 x}{3}+C$.", "D": "$-\\dfrac{\\sin 3 x}{3}+C$.", "correct": "C"}, {"id": 38, "q": "Một nguyên hàm của hàm số $f\\left( x \\right)=\\sin \\left( 2x-\\dfrac{\\pi }{3} \\right)$ là", "A": "$F\\left( x \\right)=-\\dfrac{1}{2}\\cos \\left( 2x-\\dfrac{\\pi }{3} \\right)$.", "B": "$F\\left( x \\right)=\\dfrac{1}{2}\\cos \\left( 2x-\\dfrac{\\pi }{3} \\right)$.", "C": "$F\\left( x \\right)=-\\cos \\left( 2x-\\dfrac{\\pi }{3} \\right)$.", "D": "$F\\left( x \\right)=\\cos \\left( 2x-\\dfrac{\\pi }{3} \\right)$.", "correct": "A"}, {"id": 39, "q": "Cho hàm số $f(x)=\\cos x+x$. Khẳng định nào dưới đây đúng?", "A": "$\\int\\limits f(x) \\mathrm{d}x=-\\sin x+\\dfrac{x^{2}}{2}+C$.", "B": "$\\int\\limits f(x) \\mathrm{d}x=\\sin x+x^{2}+C$.", "C": "$\\int\\limits f(x) \\mathrm{d}x=\\sin x+\\dfrac{x^{2}}{2}+C$.", "D": "$\\int\\limits f(x) \\mathrm{d}x=-\\sin x+x^{2}+C$.", "correct": "C"}, {"id": 40, "q": "Cho $\\int \\dfrac{1}{x}\\mathrm{d}x=F(x)+C$. Khẳng định nào dưới đây đúng?", "A": "$F^{\\prime}(x)=\\ln x$.", "B": "$F^{\\prime}(x)=\\dfrac{2}{x^{2}}$.", "C": "$F^{\\prime}(x)=-\\dfrac{1}{x^{2}}$.", "D": "$F^{\\prime}(x)=\\dfrac{1}{x}$.", "correct": "D"}, {"id": 41, "q": "Họ nguyên hàm của hàm số $f(x) = \\dfrac{1}{x}$ là", "A": "$\\ln|x| + C$.", "B": "$\\ln x + C$.", "C": "$-\\dfrac{1}{x^2} + C$.", "D": "$-\\dfrac{1}{x^2}$.", "correct": "A"}, {"id": 42, "q": "Họ các nguyên hàm của hàm số $f(x)=3^x-x$ là", "A": "$\\dfrac{3^x}{\\ln 3}-x^2+C$.", "B": "$\\dfrac{3^x}{\\ln 3}-\\dfrac{x^2}{2}+C$.", "C": "$3^x-x^2+C$.", "D": "$3^x-\\dfrac{x^2}{2}+C$.", "correct": "B"}, {"id": 43, "q": "Tìm họ các nguyên hàm của hàm số $y=\\mathrm{e}^x+2x$.", "A": "$\\dfrac{1}{x+1}{\\mathrm{e}^{x+1}}+x^2+C$.", "B": "$\\mathrm{e}^x+2x^2+C$.", "C": "$\\mathrm{e}^x+2+C$.", "D": "$\\mathrm{e}^x+x^2+C$.", "correct": "D"}, {"id": 44, "q": "Họ nguyên hàm của hàm số $f(x)=\\sin 3 x$ là", "A": "$-\\dfrac{1}{3} \\cos 3 x+C$.", "B": "$\\cos 3 x+C$.", "C": "$-\\cos 3 x+C$.", "D": "$\\dfrac{1}{3} \\cos 3 x+C$.", "correct": "A"}, {"id": 45, "q": "Họ nguyên hàm của hàm số $f(x) = x^{-5}$ là", "A": "$-4x^{-4} + C$.", "B": "$\\dfrac{1}{4}x^{-4} + C$.", "C": "$-\\dfrac{1}{4}x^{-4} + C$.", "D": "$-5x^{-6} + C$.", "correct": "C"}, {"id": 46, "q": "Họ nguyên hàm của hàm số $f(x)=x^3$ là", "A": "$\\dfrac{1}{2} x^2+C$.", "B": "$3 x^2+C$.", "C": "$4 x^4+C$.", "D": "$\\dfrac{1}{4} x^4+C$.", "correct": "D"}, {"id": 47, "q": "Trên khoảng $(0;+\\infty)$, họ nguyên hàm của hàm số $f(x)=\\dfrac{1}{x}$ là", "A": "$-\\ln x+C$.", "B": "$\\ln (-x)+C$.", "C": "$-\\dfrac{1}{x^2}+C$.", "D": "$\\ln x+C$.", "correct": "D"}, {"id": 48, "q": "Họ nguyên hàm của hàm số $f(x)=\\mathrm{e}^{2x}$ là", "A": "$\\dfrac{1}{2}\\mathrm{e}^{2x}+C$.", "B": "$2x\\mathrm{e}^{2x}+C$.", "C": "$2\\mathrm{e}^{2x}+C$.", "D": "$\\dfrac{1}{2}\\mathrm{e}^{x}+C$.", "correct": "A"}, {"id": 49, "q": "Cho hàm số $f(x)=\\mathrm{e}^{-2x}+\\sin x$. Khẳng định nào dưới đây đúng?", "A": "$\\displaystyle\\int f(x) \\mathrm{d}x=-\\dfrac{1}{2}\\mathrm{e}^{-2x}+\\cos x+C$.", "B": "$\\displaystyle\\int f(x) \\mathrm{d}x=-2\\mathrm{e}^{-2x}+\\cos x+C$.", "C": "$\\displaystyle\\int f(x) \\mathrm{d}x=-2\\mathrm{e}^{-2x}-\\cos x+C$.", "D": "$\\displaystyle\\int f(x) \\mathrm{d}x=-\\dfrac{1}{2}\\mathrm{e}^{-2x}-\\cos x+C$.", "correct": "D"}, {"id": 50, "q": "Cho hàm số $f(x)=\\mathrm{e}^{2x}$, khẳng định nào dưới đây đúng?", "A": "$\\displaystyle\\int f(x) \\mathrm{d}x=\\dfrac{1}{2}\\mathrm{e}^{2x}+C$.", "B": "$\\displaystyle\\int f(x) \\mathrm{d}x=2\\mathrm{e}^{2x}+C$.", "C": "$\\displaystyle\\int f(x) \\mathrm{d}x=-\\dfrac{1}{2}\\mathrm{e}^{2x}+C$.", "D": "$\\displaystyle\\int f(x) \\mathrm{d}x=\\mathrm{e}^{2x}+C$.", "correct": "A"}, {"id": 51, "q": "Khẳng định nào sau đây đúng?", "A": "$\\displaystyle\\int x^3 \\mathrm{d}x=x^4+C$.", "B": "$\\displaystyle\\int x^3 \\mathrm{d}x=\\dfrac{1}{4}x^4+C$.", "C": "$\\displaystyle\\int x^3 \\mathrm{d}x=\\dfrac{1}{3}x^4+C$.", "D": "$\\displaystyle\\int x^3 \\mathrm{d}x=3x^2+C$.", "correct": "B"}, {"id": 52, "q": "Họ nguyên hàm của hàm số $f(x)=\\dfrac{1}{x-1}$ là", "A": "$-\\dfrac{1}{(x-1)^2}+C$.", "B": "$x-\\dfrac{2}{x-1}+C$.", "C": "$\\ln\\left(x-1\\right)+C$.", "D": "$\\ln\\left|x-1\\right|+C$.", "correct": "D"}, {"id": 53, "q": "Trong các hàm số sau, hàm số nào có một nguyên hàm là hàm số $F\\left( x \\right)=\\ln \\left| 2x \\right|$", "A": "$f\\left( x \\right)=x$.", "B": "$f\\left( x \\right)=\\left| x \\right|$.", "C": "$f\\left( x \\right)=\\dfrac{1}{x}$.", "D": "$f\\left( x \\right)=\\dfrac{{{x}^{2}}}{2}$.", "correct": "C"}, {"id": 54, "q": "Cho hàm số $f(x) =4{x^3}+1$. Trong các khẳng định sau, khẳng định nào đúng?", "A": "$\\int f(x) \\mathrm{d}x={x^4}+x+C$.", "B": "$\\int f(x) \\mathrm{d}x=4{x^4}+x+C$.", "C": "$\\int f(x) \\mathrm{d}x=\\dfrac{{x^4}}{4}+x+C$.", "D": "$\\int f(x) \\mathrm{d}x={x^4}-x+C$.", "correct": "A"}, {"id": 55, "q": "Nếu $\\displaystyle\\int{f\\left( x \\right)}\\mathrm{d}x=4x^3+x^2+C$ thì hàm số $f\\left( x \\right)$ bằng", "A": "$f\\left( x \\right)=12x^2+2x$.", "B": "$f\\left( x \\right)=12x^2+2x+C$.", "C": "$f\\left( x \\right)=x^4+\\dfrac{x^3}{3}$.", "D": "$f\\left( x \\right)=x^4+\\dfrac{x^3}{3}+Cx$.", "correct": "A"}, {"id": 56, "q": "$\\displaystyle \\int{3x^2dx}$ bằng", "A": "$3x^3+C$.", "B": "$\\dfrac{1}{3}x^3+C$.", "C": "$6x+C$.", "D": "$x^3+C$.", "correct": "D"}, {"id": 57, "q": "Tìm họ các nguyên hàm của hàm số $f\\left( x \\right)=6x^2-\\sin 2x$", "A": "$2x^3+\\cos 2x+C$.", "B": "$2x^3+\\dfrac{1}{2}\\cos 2x+C$.", "C": "$3x^2+\\dfrac{1}{2}\\cos 2x+C$.", "D": "$2x^3-\\dfrac{1}{2}\\cos 2x+C$.", "correct": "B"}, {"id": 58, "q": "Cho hàm số $f(x)=x^2+2$. Khẳng định nào dưới đây đúng?", "A": "$\\displaystyle\\int{f(x)\\mathrm{d}x=2x+C}$.", "B": "$\\displaystyle\\int{f( x )\\mathrm{d}x=x^3+2x+C}$.", "C": "$\\displaystyle\\int{f( x )\\mathrm{d}x=\\dfrac{x^3}{3}+2x+C}$.", "D": "$\\displaystyle\\int{f( x )\\mathrm{d}x=x^2+2x+C}$.", "correct": "C"}, {"id": 59, "q": "Cho hàm số $f( x )=4{x^3}-2$. Khẳng định nào dưới đây đúng?", "A": "$\\int{f( x )\\mathrm{d}x}=4{x^3}-2x+C$.", "B": "$\\int{f( x )\\mathrm{d}x}=12{x^2}+C$.", "C": "$\\int{f( x )\\mathrm{d}x}={x^4}+C$.", "D": "$\\int{f( x )\\mathrm{d}x}={x^4}-2x+C$.", "correct": "D"}, {"id": 60, "q": "Cho hàm số $f(x)=2+\\cos x$ . Khẳng định nào dưới đây đúng?", "A": "$\\int{f(x)\\mathrm{d}x}=2x+\\sin x+C$.", "B": "$\\int{f(x)\\mathrm{d}x}=-\\sin x+C$.", "C": "$\\int{f(x)\\mathrm{d}x}=2x-\\sin x+C$.", "D": "$\\int{f(x)\\mathrm{d}x}=2x+\\cos x+C$.", "correct": "A"}, {"id": 61, "q": "$\\displaystyle\\int \\dfrac{1}{x} \\mathrm{d}x$ bằng", "A": "$\\dfrac{1}{x^{2}}+C$.", "B": "$\\ln x+C$.", "C": "$\\ln \\left| x \\right|+C$.", "D": "$-\\dfrac{1}{x^{2}}+C$.", "correct": "C"}, {"id": 62, "q": "Tìm nguyên hàm của hàm số $f\\left( x \\right)=\\cos 4x$.", "A": "$\\int{f\\left( x \\right)\\text{d}x}=4\\sin 4x+C$.", "B": "$\\int{f\\left( x \\right)\\text{d}x}=-\\dfrac{1}{4}\\sin 4x+C$.", "C": "$\\int{f\\left( x \\right)\\text{d}x}=\\dfrac{1}{4}\\sin 4x+C$.", "D": "$\\int{f\\left( x \\right)\\text{d}x}=-4\\sin 4x+C$.", "correct": "C"}, {"id": 63, "q": "Hàm số $G\\left( x \\right)$ là một nguyên hàm của hàm số $g\\left( x \\right)$ trên tập $K$ và $C$ là hằng số thực tùy ý. Khẳng định nào sau đây là đúng?", "A": "$G'(x)=g(x)+C,\\forall x\\in K$.", "B": "$\\displaystyle\\int {G}'(x)\\mathrm{d}x=G(x),\\forall x\\in K$.", "C": "$g'(x)=G(x),\\forall x\\in K$.", "D": "$\\displaystyle\\int g(x)\\mathrm{d}x=G(x)+C$.", "correct": "D"}, {"id": 64, "q": "Cho hàm số $f(x)=\\cos 2x$. Khẳng định nào sau đây là đúng?", "A": "$\\displaystyle\\int f(x) \\mathrm{d}x=-\\dfrac{1}{2}\\sin 2x+C$.", "B": "$\\displaystyle\\int f(x) \\mathrm{d}x=2\\sin 2x+C$.", "C": "$\\displaystyle\\int f(x) \\mathrm{d}x=-2\\sin 2x+C$.", "D": "$\\displaystyle\\int f(x) \\mathrm{d}x=\\dfrac{1}{2}\\sin 2x+C$.", "correct": "D"}, {"id": 65, "q": "Cho hàm số $f(x)=3x^2-1$. Khẳng định nào sau đây là đúng?", "A": "$\\displaystyle\\int f(x) \\mathrm{d}x=x^3+C$.", "B": "$\\displaystyle\\int f(x) \\mathrm{d}x=x^3-x+C$.", "C": "$\\displaystyle\\int f(x) \\mathrm{d}x=\\dfrac{1}{3}x^3-x+C$.", "D": "$\\displaystyle\\int f(x) \\mathrm{d}x=3x^3-x+C$.", "correct": "B"}, {"id": 66, "q": "Nguyên hàm của hàm số $f\\left( x \\right)=x^3$ là", "A": "$\\int{x^3}\\text{d}x=\\dfrac{x^2}{2}+C$.", "B": "$\\int{x^3}\\text{d}x=\\dfrac{x^4}{4}+C$.", "C": "$\\int{x^3}\\text{d}x=4x^4+C$.", "D": "$\\int{x^3}\\text{d}x=\\dfrac{x^3}{3}+C$.", "correct": "B"}, {"id": 67, "q": "Hàm số nào sau đây không phải là một nguyên hàm của hàm số $f\\left(x \\right)=\\left( 2x-3 \\right)^{3}$?", "A": "$F\\left( x \\right)=\\dfrac{\\left( 2x-3 \\right)^{4}}{8}$.", "B": "$F\\left( x \\right)=\\dfrac{\\left( 2x-3 \\right)^{4}}{8}+8$.", "C": "$F\\left( x \\right)=\\dfrac{\\left( 2x-3 \\right)^{4}}{8}-3$.", "D": "$F\\left( x \\right)=\\dfrac{\\left( 2x-3 \\right)^{4}}{4}$.", "correct": "D"}, {"id": 68, "q": "Họ nguyên hàm của hàm số $f(x)=3x^2+\\sin x$ là", "A": "$\\displaystyle\\int \\left(3x^2+\\sin x\\right) \\mathrm{d}x=x^3+\\sin x+ C$.", "B": "$\\displaystyle\\int \\left(3x^2+\\sin x\\right) \\mathrm{d}x=x^3+\\cos x+C$.", "C": "$\\displaystyle\\int \\left(3x^2+\\sin x\\right) \\mathrm{d}x=3x^3-\\sin x+C$.", "D": "$\\displaystyle\\int \\left(3x^2+\\sin x\\right) \\mathrm{d}x=x^3 -\\cos x+C$.", "correct": "D"}, {"id": 69, "q": "Tìm nguyên hàm của hàm số $f(x)=2x+1$", "A": "$\\displaystyle\\int \\left(2x+1\\right) \\mathrm{d}x=2x^2 +x+C$.", "B": "$\\displaystyle\\int \\left(2x+1\\right) \\mathrm{d}x=\\dfrac{x^2}{2} +x+C$.", "C": "$\\displaystyle\\int \\left(2x+1\\right) \\mathrm{d}x=x^2 +x+C$.", "D": "$\\displaystyle\\int \\left(2x+1\\right) \\mathrm{d}x=x^2+C$.", "correct": "C"}, {"id": 70, "q": "Cho hàm số $f(x)=\\sin 3x+1$. Trong các khẳng định sau, khẳng định nào đúng?", "A": "$\\displaystyle\\int f(x) \\mathrm{d}x=\\dfrac{1}{3}\\cos 3x+x+C$.", "B": "$\\displaystyle\\int f(x) \\mathrm{d}x=-\\dfrac{1}{3}\\cos 3x+x+C$.", "C": "$\\displaystyle\\int f(x) \\mathrm{d}x=-3\\cos 3x+x+C$.", "D": "$\\displaystyle\\int f(x) \\mathrm{d}x=3\\cos 3x+x+C$.", "correct": "B"}, {"id": 71, "q": "Tìm họ nguyên hàm của hàm số $f(x)=x^{2021}$ trên $\\mathbb{R}$.", "A": "$\\displaystyle\\int f(x) \\mathrm{d}x=2021x^{2020}+C$.", "B": "$\\displaystyle\\int f(x) \\mathrm{d}x=\\dfrac{x^{2022}}{2022}$.", "C": "$\\displaystyle\\int f(x) \\mathrm{d}x=\\dfrac{x^{2022}}{2022}+C$.", "D": "$\\displaystyle\\int f(x) \\mathrm{d}x=\\dfrac{x^{2021}}{2021}+C$.", "correct": "C"}, {"id": 72, "q": "Cho hàm số $f(x)=\\mathrm{e}^{3x-1}$. Trong các khẳng định sau, khẳng định nào đúng?", "A": "$\\displaystyle\\int f(x) \\mathrm{d}x=-\\dfrac{1}{3} \\mathrm{e}^{3x-1}+C$.", "B": "$\\displaystyle\\int f(x) \\mathrm{d}x=3 \\mathrm{e}^{3x-1}+C$.", "C": "$\\displaystyle\\int f(x) \\mathrm{d}x=\\dfrac{1}{3} \\mathrm{e}^{3x-1}+C$.", "D": "$\\displaystyle\\int f(x) \\mathrm{d}x=\\mathrm{e}^{3x-1}+C$.", "correct": "C"}, {"id": 73, "q": "Nguyên hàm của hàm số $y=\\sin (2021x)$ là", "A": "$\\displaystyle\\int f(x) \\mathrm{d}x=-2021 \\cos (2021x)+C$.", "B": "$\\displaystyle\\int f(x) \\mathrm{d}x=\\dfrac{1}{2021} \\cos (2021x)+C$.", "C": "$\\displaystyle\\int f(x) \\mathrm{d}x=2021 \\cos (2021x)+C$.", "D": "$\\displaystyle\\int f(x) \\mathrm{d}x=-\\dfrac{1}{2021} \\cos (2021x)+C$.", "correct": "D"}, {"id": 74, "q": "Hàm số nào sau đây là một nguyên hàm của hàm số $f(x)=\\mathrm{e}^{2x}$?", "A": "$F(x)=2\\mathrm{e}^{2x}+1$.", "B": "$F(x)=\\dfrac{1}{2}\\mathrm{e}^{2x}+2020$.", "C": "$F(x)=\\dfrac{1}{2}\\mathrm{e}^{2x}+x$.", "D": "$F(x)=\\mathrm{e}^{2x}+2021$.", "correct": "B"}, {"id": 75, "q": "Họ các nguyên hàm của hàm số $f(x)=\\sin 3x$ là", "A": "$-\\cos 3x+C$.", "B": "$-\\dfrac{1}{3}\\cos 3x+C$.", "C": "$\\dfrac{1}{3}\\cos 3x+C$.", "D": "$\\cos 3x+C$.", "correct": "B"}, {"id": 76, "q": "Cho hàm số $f(x)=\\cos2x$. Trong các khẳng định sau, khẳng định nào đúng?", "A": "$\\int f(x)\\mathrm{d}x=\\dfrac{\\sin 2x}{2}+C$.", "B": "$\\int f(x)\\mathrm{d}x=-\\dfrac{\\sin 2x}{2}+C$.", "C": "$\\int f(x)\\mathrm{d}x=-2\\sin 2x+C$.", "D": "$\\int f(x)\\mathrm{d}x=2\\sin 2x+C$.", "correct": "A"}, {"id": 77, "q": "Cho $f(x) = \\sin 2x$. Khẳng định nào dưới đây đúng?", "A": "$\\displaystyle \\int f(x)\\mathrm{d}x = \\dfrac{1}{2}\\cos 2x + C$.", "B": "$\\displaystyle \\int f(x)\\mathrm{d}x = -2\\cos 2x + C$.", "C": "$\\displaystyle \\int f(x)\\mathrm{d}x = -\\dfrac{1}{2}\\cos 2x + C$.", "D": "$\\displaystyle \\int f(x)\\mathrm{d}x = 2\\cos 2x + C$.", "correct": "C"}, {"id": 78, "q": "Nguyên hàm của hàm số $f(x)=2 \\cos 2 x$ là hàm số nào trong các hàm số sau", "A": "$F(x)=2 x \\sin 2 x+C$.", "B": "$F(x)=4 \\sin 2 x+C$.", "C": "$F(x)=-4 x \\sin x+C$.", "D": "$F(x)=\\sin 2 x+C$.", "correct": "D"}, {"id": 79, "q": "Cho hàm số $f(x)=\\mathrm{e}^{3x}.$ Họ các nguyên hàm của hàm số $f(x)$ là", "A": "$\\dfrac{1}{3}{\\mathrm{e}^{3x}}+C$.", "B": "$\\text{3}{\\mathrm{e}^x}+C$.", "C": "$\\text{3}{\\mathrm{e}^{3x}}+C$.", "D": "$\\dfrac{1}{3}{\\mathrm{e}^x}+C$.", "correct": "A"}, {"id": 80, "q": "Tính $\\displaystyle\\int \\mathrm{e}^{3x}\\mathrm{d}x$.", "A": "$\\dfrac{\\mathrm{e}^{3x}}{9}+C$.", "B": "$\\mathrm{e}^{3x}+C$.", "C": "$3\\mathrm{e}^{3x}+C$.", "D": "$\\dfrac{\\mathrm{e}^{3x}}{3}+C$.", "correct": "D"}, {"id": 81, "q": "Tìm họ nguyên hàm của hàm số $f(x)=\\cos 3 x$.", "A": "$\\displaystyle\\int \\cos 3x \\mathrm{d} x=\\dfrac{\\sin 3 x}{3}+C$.", "B": "$\\displaystyle\\int \\cos 3x \\mathrm{d} x=-\\dfrac{\\sin 3 x}{3}+C$.", "C": "$\\displaystyle\\int \\cos 3x \\mathrm{d} x=\\sin 3 x+C$.", "D": "$\\displaystyle\\int \\cos 3x \\mathrm{d} x=3 \\sin 3 x+C$.", "correct": "A"}, {"id": 82, "q": "Khẳng định nào sau đây đúng?", "A": "$\\displaystyle\\int\\sin 2x\\mathrm{d}x=-2\\cos 2x+C$.", "B": "$\\displaystyle\\int\\sin 2x\\mathrm{d}x=\\dfrac{1}{2}\\cos 2x+C$.", "C": "$\\displaystyle\\int\\sin 2x\\mathrm{d}x=-\\dfrac{1}{2}\\cos 2x+C$.", "D": "$\\displaystyle\\int\\sin 2x\\mathrm{d}x=2\\cos 2x+C$.", "correct": "C"}, {"id": 83, "q": "Tìm nguyên hàm của hàm số $f(x)=(x+1)^2$.", "A": "$L=\\dfrac{(x+1)^3}{3}+C$, $C$ là hằng số.", "B": "$L=2x+C$, $C$ là hằng số.", "C": "$L=2(x+1)+C$, $C$ là hằng số.", "D": "$L=\\dfrac{1}{3}x^3+x^2+C$, $C$ là hằng số.", "correct": "A"}, {"id": 84, "q": "Họ tất cả các nguyên hàm của hàm số $f(x)= 7^{2x}$ là", "A": "$2 \\cdot 49^{x} \\ln 7 +C$.", "B": "$2 \\cdot \\dfrac{49^{x}}{ \\ln 7} +C$.", "C": "$\\dfrac{49^{x}}{2 \\ln 7} +C$.", "D": "$\\dfrac{49^{x+1}}{x+1} +C$.", "correct": "C"}, {"id": 85, "q": "Họ tất cả các nguyên hàm của hàm số $f(x)= \\sin 3x$ là", "A": "$\\dfrac{1}{3} \\cos 3x +C$.", "B": "$-\\dfrac{1}{3} \\cos 3x +C$.", "C": "$\\cos 3x +C$.", "D": "$-\\cos 3x +C$.", "correct": "B"}, {"id": 86, "q": "Tìm họ tất cả các nguyên hàm của hàm số $f(x)=\\dfrac{1}{1-2x}$ trên $\\left(-\\infty;\\dfrac{1}{2}\\right)$.", "A": "$\\dfrac{1}{2}\\ln (1-2x)+C$.", "B": "$\\ln |2x-1|+C$.", "C": "$\\dfrac{1}{2}\\ln |2x-1|+C$.", "D": "$-\\dfrac{1}{2}\\ln (1-2x)+C$.", "correct": "D"}, {"id": 87, "q": "Trong các mệnh đề sau, mệnh đề đúng là", "A": "$\\displaystyle\\int\\limits \\dfrac{1}{3-2 x}\\mathrm{d}x=-\\dfrac{1}{2}\\ln (3-2 x)+C$.", "B": "$\\displaystyle\\int\\limits \\dfrac{1}{3-2 x}\\mathrm{d}x=-\\dfrac{1}{2}\\ln |3-2 x|+C$.", "C": "$\\displaystyle\\int\\limits \\dfrac{1}{3-2 x}\\mathrm{d}x=\\dfrac{1}{3}\\ln (3-2 x)+C$.", "D": "$\\displaystyle\\int\\limits \\dfrac{1}{3-2 x}\\mathrm{d}x=\\dfrac{1}{3}\\ln |3-2 x|+C$.", "correct": "B"}, {"id": 88, "q": "Cho $u(x)$ là hàm số có đạo hàm liên tục trên $\\mathbb{R}$, khi đó", "A": "$\\displaystyle\\int \\left[u(x)\\right]^2\\cdot u'(x) \\mathrm{d}x=2u(x)+C$.", "B": "$\\displaystyle\\int \\left[u(x)\\right]^2\\cdot u'(x) \\mathrm{d}x=\\dfrac{1}{3}\\left[u(x)\\right]^3+C$.", "C": "$\\displaystyle\\int \\left[u(x)\\right]^2\\cdot u'(x) \\mathrm{d}x=3\\left[u(x)\\right]^3+C$.", "D": "$\\displaystyle\\int \\left[u(x)\\right]^2\\cdot u'(x) \\mathrm{d}x=\\dfrac{1}{2}\\left[u(x)\\right]^2+C$.", "correct": "B"}, {"id": 89, "q": "Họ nguyên hàm của hàm số $f(x)=\\dfrac{1}{5x-2}$ là", "A": "$\\displaystyle\\int\\limits\\dfrac{\\mathrm{d}x}{5x-2}=-\\dfrac{1}{2}\\ln|5x-2|+C$.", "B": "$\\displaystyle\\int\\limits\\dfrac{\\mathrm{d}x}{5x-2}=5\\ln|5x-2|+C$.", "C": "$\\displaystyle\\int\\limits\\dfrac{\\mathrm{d}x}{5x-2}=\\dfrac{1}{5}\\ln|5x-2|+C$.", "D": "$\\displaystyle\\int\\limits\\dfrac{\\mathrm{d}x}{5x-2}=\\ln|5x-2|+C$.", "correct": "C"}, {"id": 90, "q": "Gọi $\\displaystyle\\int 2020^{2x} \\mathrm{d}x=F(x)+C$, với $C$ là hằng số. Khi đó hàm số $F(x)$ bằng", "A": "$\\dfrac{2020^{2x}}{2\\ln 2020}$.", "B": "$\\dfrac{x2020^{2x-1}}{\\ln 2020}$.", "C": "$\\dfrac{2020^{x}}{2\\ln 2020}$.", "D": "$\\dfrac{2020^{2x}}{\\ln 2020}$.", "correct": "A"}, {"id": 91, "q": "Cho hàm số $f(x)=\\mathrm{e}^{-3x}$. Khẳng định nào sau đây đúng?", "A": "$\\displaystyle\\int f(x)\\mathrm{d}x=-\\dfrac{1}{3}\\mathrm{e}^{-3x}+C$.", "B": "$\\displaystyle\\int f(x)\\mathrm{d}x=-3\\mathrm{e}^{-3x}+C$.", "C": "$\\displaystyle\\int f(x)\\mathrm{d}x=\\mathrm{e}^{-3x}+C$.", "D": "$\\displaystyle\\int f(x)\\mathrm{d}x=-\\mathrm{e}^{-3x}+C$.", "correct": "A"}, {"id": 92, "q": "Cho hàm số $f(x)=\\mathrm{e}^{2x}+x-3$. Khẳng định nào sau đây đúng?", "A": "$\\displaystyle\\int f(x)\\mathrm{d}x=\\dfrac{\\mathrm{e}^{2x}}{2}+\\dfrac{x^2}{2}-3x+C$.", "B": "$\\displaystyle\\int f(x)\\mathrm{d}x=2\\mathrm{e}^{2x}+\\dfrac{x^2}{2}-3x+C$.", "C": "$\\displaystyle\\int f(x)\\mathrm{d}x=2\\mathrm{e}^{2x}+1+C$.", "D": "$\\displaystyle\\int f(x)\\mathrm{d}x=\\mathrm{e}^{2x}+\\dfrac{x^2}{2}-3x+C$.", "correct": "A"}, {"id": 93, "q": "Hàm số nào sau đây là một nguyên hàm của hàm số $f(x)=\\mathrm{e}^{2x}$?", "A": "$F(x)=\\mathrm{e}^{2x}+2021$.", "B": "$F(x)=\\dfrac{1}{2}\\mathrm{e}^{2x}+2020$.", "C": "$F(x)=2\\mathrm{e}^{2x}+1$.", "D": "$F(x)=\\dfrac{1}{2}\\mathrm{e}^{2x}+x$.", "correct": "B"}, {"id": 94, "q": "Họ nguyên hàm của hàm số $f(x)=\\sin 5x$ là", "A": "$F(x)=\\dfrac{1}{5}\\cos 5x+C$.", "B": "$F(x)=-\\dfrac{1}{5}\\cos 5x+C$.", "C": "$F(x)=-\\cos 5x+C$.", "D": "$F(x)=5\\cos 5x+C$.", "correct": "B"}, {"id": 95, "q": "Tìm $\\displaystyle\\int \\dfrac{1}{2x+1}\\mathrm{d}x$, ta được", "A": "$\\dfrac{1}{2}\\ln (2x+1)+C$.", "B": "$\\dfrac{1}{2}\\ln |2x+1|+C$.", "C": "$-\\dfrac{2}{(2x+1)^2}+C$.", "D": "$\\ln |2x+1|+C$.", "correct": "B"}, {"id": 96, "q": "Tìm nguyên hàm $F(x)$ của hàm số $f(x)=\\mathrm{e}^{3x}$, biết $F(0)=1$.", "A": "$F(x)=\\mathrm{e}^{3x}+1$.", "B": "$F(x)=\\dfrac{1}{3}\\mathrm{e}^{3x}+\\dfrac{2}{3}$.", "C": "$F(x)=3\\mathrm{e}^{3x}-2$.", "D": "$F(x)=\\dfrac{1}{3}\\mathrm{e}^{3x}+\\dfrac{1}{3}$.", "correct": "B"}, {"id": 97, "q": "Khẳng định nào sau đây sai?", "A": "$\\displaystyle\\int0\\mathrm{d}x = C$.", "B": "$\\displaystyle\\int x^4\\mathrm{d}x = \\dfrac{x^5}{5} + C$.", "C": "$\\displaystyle\\int \\mathrm{e}^x\\mathrm{d}x = \\mathrm{e}^x+C$.", "D": "$\\displaystyle\\int\\dfrac{1}{x}\\mathrm{d}x = \\ln x + C$.", "correct": "D"}, {"id": 98, "q": "Hàm số nào sau đây không phải là một nguyên hàm của hàm số $f(x)=(2x-3)^3$?", "A": "$F(x)=\\dfrac{(2x-3)^4}{8}$.", "B": "$F(x)=\\dfrac{2x-3)^4}{8}+8$.", "C": "$F(x)=\\dfrac{(2x-3)^4}{8}-3$.", "D": "$F(x)=\\dfrac{(2x-3)^4}{4}$.", "correct": "D"}, {"id": 99, "q": "Tìm nguyên hàm của hàm số $f(x)=5^x\\cdot 7^x$.", "A": "$\\displaystyle\\int f(x)\\mathrm{d}x=35^x\\ln 35+C$.", "B": "$\\displaystyle\\int f(x)\\mathrm{d}x=\\dfrac{35^{x+1}}{x+1}+C$.", "C": "$\\displaystyle\\int f(x)\\mathrm{d}x=\\dfrac{35^x}{\\ln 35}+C$.", "D": "$\\displaystyle\\int f(x)\\mathrm{d}x=35^{x+1}+C$.", "correct": "C"}, {"id": 100, "q": "Họ nguyên hàm của hàm số $f(x)=2(\\cos 2x+x)$ là", "A": "$-\\sin 2x+x^2+C$.", "B": "$-\\dfrac{1}{2}\\sin 2x+\\dfrac{1}{2}x^2+C$.", "C": "$\\dfrac{1}{2}\\sin 2x+\\dfrac{1}{2}x^2+C$.", "D": "$\\sin 2x+x^2+C$.", "correct": "D"}, {"id": 101, "q": "Trong các khẳng định sau, khẳng định nào sai?", "A": "$\\displaystyle\\int x^a \\mathrm{ d}x =\\dfrac{x^{a+1}}{a+1}+C$.", "B": "$\\displaystyle\\int \\mathrm{ d}x =x+C$.", "C": "$\\displaystyle\\int \\dfrac{1}{x}\\mathrm{ d}x=\\ln|x| +C$.", "D": "$\\displaystyle \\int 0 \\mathrm{ d}x=C$.", "correct": "A"}, {"id": 102, "q": "Tìm nguyên hàm $I$ của hàm số $y= \\mathrm{e}^x -3x^2$.", "A": "$I = \\mathrm{e}^x+x^3+C$.", "B": "$I = \\mathrm{e}^x+6x+C$.", "C": "$I = \\mathrm{e}^x-6x+C$.", "D": "$I = \\mathrm{e}^x-x^3+C$.", "correct": "D"}, {"id": 103, "q": "Tìm nguyên hàm của hàm số $f(x)=\\mathrm{e}^x - \\mathrm{e}^{-x}$.", "A": "$\\displaystyle \\int f(x) \\mathrm{d}x = -\\mathrm{e}^x - \\mathrm{e}^{-x} + C$.", "B": "$\\displaystyle \\int f(x) \\mathrm{d}x = \\mathrm{e}^x - \\mathrm{e}^{-x} + C$.", "C": "$\\displaystyle \\int f(x) \\mathrm{d}x = -\\mathrm{e}^x + \\mathrm{e}^{-x} + C$.", "D": "$\\displaystyle \\int f(x) \\mathrm{d}x = \\mathrm{e}^x + \\mathrm{e}^{-x} + C$.", "correct": "D"}];
const TOTAL_PER_GAME = 20;
const SECONDS_PER_Q = 30;

function shuffle(a){
  const arr = a.slice();
  for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; }
  return arr;
}
function pad2(n){ return String(n).padStart(2,'0'); }

// Audio
// Intro MP3 (phát ở màn hình nhập Họ tên / Lớp)
const INTRO_SRC = "intro.mp3";
const introAudio = document.getElementById("introAudio");
let introPlaying = false;

function tryPlayIntro(){
  if(!introAudio) return;
  if(!introAudio.src){
    introAudio.src = INTRO_SRC;
  }
  introAudio.volume = 1.0;
  const p = introAudio.play();
  introPlaying = true;
  if(p && p.catch){
    p.catch(()=>{ introPlaying = false; /* autoplay bị chặn, sẽ thử lại khi người dùng tương tác */ });
  }
}

function stopIntro(){
  if(!introAudio) return;
  introAudio.pause();
  try{ introAudio.currentTime = 0; }catch(e){}
  introPlaying = false;
}

function ensureIntro(){
  if(!introPlaying) tryPlayIntro();
}

let audioOn = true;
let audioCtx = null;
let audioOut = null;

function getAudioOut(){
  audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)();
  if(!audioOut){
    const comp = audioCtx.createDynamicsCompressor();
    comp.threshold.value = -22;
    comp.knee.value = 30;
    comp.ratio.value = 10;
    comp.attack.value = 0.003;
    comp.release.value = 0.25;

    const master = audioCtx.createGain();
    master.gain.value = 0.95;

    comp.connect(master);
    master.connect(audioCtx.destination);
    audioOut = comp;
  }
  return audioOut;
}

function beep(freqs, durMs, waveType="sine", peak=0.28){
  if(!audioOn) return;
  try{
    const out = getAudioOut();
    const now = audioCtx.currentTime;
    const end = now + (durMs/1000);

    const g = audioCtx.createGain();
    g.gain.setValueAtTime(0.0001, now);
    g.gain.linearRampToValueAtTime(peak, now + 0.015);
    g.gain.setValueAtTime(peak*0.65, now + 0.12);
    g.gain.exponentialRampToValueAtTime(0.0001, end);
    g.connect(out);

    freqs.forEach((f,i)=>{
      const o = audioCtx.createOscillator();
      o.type = waveType;
      o.frequency.setValueAtTime(f, now);
      o.detune.setValueAtTime((i%2 ? -6 : 6), now); // hơi "rung" cho mạnh mẽ
      o.connect(g);
      o.start(now + i*0.01);
      o.stop(end + 0.05);
    });
  }catch(e){}
}

function kick(){
  if(!audioOn) return;
  try{
    const out = getAudioOut();
    const now = audioCtx.currentTime;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = "sine";
    o.frequency.setValueAtTime(160, now);
    o.frequency.exponentialRampToValueAtTime(55, now + 0.16);
    g.gain.setValueAtTime(0.0001, now);
    g.gain.linearRampToValueAtTime(0.38, now + 0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, now + 0.22);
    o.connect(g); g.connect(out);
    o.start(now); o.stop(now + 0.25);
  }catch(e){}
}

function noiseBurst(dur=0.12, peak=0.22){
  if(!audioOn) return;
  try{
    const out = getAudioOut();
    const now = audioCtx.currentTime;
    const buffer = audioCtx.createBuffer(1, Math.floor(audioCtx.sampleRate*dur), audioCtx.sampleRate);
    const data = buffer.getChannelData(0);
    for(let i=0;i<data.length;i++){
      data[i] = (Math.random()*2-1) * (1 - i/data.length);
    }
    const src = audioCtx.createBufferSource();
    src.buffer = buffer;

    const g = audioCtx.createGain();
    g.gain.setValueAtTime(0.0001, now);
    g.gain.linearRampToValueAtTime(peak, now + 0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, now + dur);

    src.connect(g); g.connect(out);
    src.start(now); src.stop(now + dur);
  }catch(e){}
}

function soundGood(){
  // Âm đúng: sôi nổi, mạnh mẽ (~3s)
  kick(); noiseBurst(0.10, 0.20);

  // Fanfare (C major) + lên tông
  beep([523.25, 659.25, 783.99], 650, "sawtooth", 0.26);
  setTimeout(()=>beep([659.25, 783.99, 987.77], 700, "sawtooth", 0.26), 220);
  setTimeout(()=>beep([783.99, 987.77, 1174.66], 750, "triangle", 0.24), 480);

  setTimeout(()=>{
    noiseBurst(0.14, 0.18);
    beep([1046.50, 1318.51], 850, "square", 0.22);
  }, 820);

  // Chốt bằng hợp âm sáng
  setTimeout(()=>beep([1046.50, 1318.51, 1567.98], 1400, "sine", 0.20), 1250);
}

function soundBad(){
  // Âm sai: rõ ràng, dứt khoát (~1.6s)
  noiseBurst(0.08, 0.14);
  beep([220, 196], 1100, "sawtooth", 0.26);
  setTimeout(()=>beep([174], 700, "sine", 0.18), 450);
}



// DOM
const $ = (id)=>document.getElementById(id);
const screenStart = $("screenStart");
const screenGame = $("screenGame");
const screenResult = $("screenResult");

const btnStart = $("btnStart");
const btnHow = $("btnHow");
const howText = $("howText");


const playerName = $("playerName");
const playerClass = $("playerClass");
// Phát intro khi người dùng tương tác ô nhập (đảm bảo chạy được trên điện thoại)
["pointerdown","touchstart","focus","input","keydown"].forEach(evt=>{
  playerName && playerName.addEventListener(evt, ensureIntro, {passive:true});
  playerClass && playerClass.addEventListener(evt, ensureIntro, {passive:true});
});
const playerWarn = $("playerWarn");
const btnExport = $("btnExport");
const exportNote = $("exportNote");


const qNum = $("qNum");
const qTimer = $("qTimer");
const timeBar = $("timeBar");
const qText = $("qText");
const choices = $("choices");
const toast = $("toast");

const btnPrev = $("btnPrev");
const btnNext = $("btnNext");
const btnExitReview = $("btnExitReview");
const navHint = $("navHint");

const sProg = $("sProg");
const sGood = $("sGood");
const sBad  = $("sBad");

const btnStop = $("btnStop");
const btnMute = $("btnMute");

const rGood = $("rGood");
const rBad  = $("rBad");
const rScore= $("rScore");
const resultTime = $("resultTime");
const btnReplay = $("btnReplay");
const btnReview = $("btnReview");
const reviewNote = $("reviewNote");

// State
let game = null;
let reviewMode = false;
let tick = null;

function show(screen){
  [screenStart, screenGame, screenResult].forEach(s=>s.classList.remove("active"));
  screen.classList.add("active");
}

function buildGame(){
  const pick20 = shuffle(BANK).slice(0, TOTAL_PER_GAME).map(q => ({
    id: q.id,
    q: q.q,
    options: { A:q.A, B:q.B, C:q.C, D:q.D },
    correct: q.correct,
    chosen: null,
    locked: false,
    timeLeft: SECONDS_PER_Q
  }));
  return {
    startAt: Date.now(),
    endAt: null,
    index: 0,
    items: pick20,
    finished: false
  };
}

function stopTimer(){ if(tick){ clearInterval(tick); tick=null; } }

function startTimer(){
  stopTimer();
  tick = setInterval(()=>{
    if(!game || game.finished) return;
    const item = game.items[game.index];
    if(item.locked) return;
    item.timeLeft -= 0.1;
    if(item.timeLeft <= 0){
      item.timeLeft = 0;
      onTimeout();
      return;
    }
    renderTimer(item.timeLeft);
  }, 100);
}

function renderTimer(sec){
  const s = Math.max(0, Math.ceil(sec));
  qTimer.textContent = "00:" + pad2(s);
  const pct = (sec/SECONDS_PER_Q)*100;
  timeBar.style.width = pct + "%";
}

function stats(){
  let done=0, good=0, bad=0;
  for(const it of game.items){
    if(it.chosen!==null){
      done++;
      if(it.chosen===it.correct) good++;
      else bad++;
    }
  }
  return {done, good, bad};
}

function renderStats(){
  const st = game ? stats() : {done:0, good:0, bad:0};
  sProg.textContent = st.done + "/" + TOTAL_PER_GAME;
  sGood.textContent = String(st.good);
  sBad.textContent  = String(st.bad);
}

function renderQuestion(){
  const it = game.items[game.index];
  qNum.textContent = "Câu " + (game.index+1) + "/" + TOTAL_PER_GAME;
  toast.textContent = "";
  toast.className = "toast";
  navHint.textContent = it.locked ? "Đã chấm. Bấm “Câu tiếp” để qua câu mới." : "Chọn đáp án để chấm.";
  btnPrev.disabled = (game.index===0);
  btnNext.disabled = !it.locked;

  qText.innerHTML = it.q;
  choices.innerHTML = "";

  const letters = ["A","B","C","D"];
  for(const L of letters){
    const btn = document.createElement("button");
    btn.className = "btn choice";
    btn.type = "button";
    btn.innerHTML = "<b style='margin-right:10px;color:var(--orange2)'>" + L + ".</b> <span>" + it.options[L] + "</span>";
    if(it.locked) btn.classList.add("disabled");
    btn.addEventListener("click", ()=>choose(L));
    choices.appendChild(btn);
  }

  if(window.MathJax && MathJax.typesetPromise){ MathJax.typesetPromise([qText, choices]).catch(()=>{}); }
  renderTimer(it.timeLeft);
  if(it.locked) markChoices(it);
  renderStats();
}

function markChoices(it){
  const nodes = [...choices.children];
  const letters = ["A","B","C","D"];
  nodes.forEach((node, idx)=>{
    node.classList.remove("correct","wrong");
    const L = letters[idx];
    if(L===it.correct) node.classList.add("correct");
    if(it.chosen && L===it.chosen && it.chosen!==it.correct) node.classList.add("wrong");
  });
}

function lockAndMaybeFinish(){
  const it = game.items[game.index];
  btnNext.disabled = false;

  if(game.index === TOTAL_PER_GAME-1){
    setTimeout(()=>finishGame(), 600);
  }
}

function choose(letter){
  if(!game || game.finished) return;
  const it = game.items[game.index];
  if(it.locked) return;

  it.chosen = letter;
  it.locked = true;
  it.spent = Math.max(0, SECONDS_PER_Q - it.timeLeft);

  if(letter === it.correct){
    toast.textContent = "✅ Chính xác!";
    toast.className = "toast good";
    soundGood();
  } else {
    toast.textContent = "❌ Chưa đúng.";
    toast.className = "toast bad";
    soundBad();
  }
  markChoices(it);
  renderStats();
  lockAndMaybeFinish();

  // Tự động chuyển câu kế tiếp sau khi hiện đáp án đúng
  const gradedIndex = game.index;
  if(gradedIndex < TOTAL_PER_GAME-1){
    setTimeout(()=>{
      if(!game || game.finished) return;
      if(game.index !== gradedIndex) return; // tránh nhảy 2 lần nếu người dùng bấm Next
      next();
    }, 900);
  }
}

function onTimeout(){
  const it = game.items[game.index];
  if(it.locked) return;

  it.chosen = "—";
  it.locked = true;
  it.spent = SECONDS_PER_Q;

  toast.textContent = "⏱️ Hết giờ! Tính là sai.";
  toast.className = "toast bad";
  soundBad();
  markChoices(it);
  renderStats();
  lockAndMaybeFinish();

  // Hết giờ: hiện đáp án đúng rồi tự chuyển câu
  const gradedIndex = game.index;
  if(gradedIndex < TOTAL_PER_GAME-1){
    setTimeout(()=>{
      if(!game || game.finished) return;
      if(game.index !== gradedIndex) return;
      next();
    }, 900);
  }
}

function next(){
  if(!game) return;
  if(game.index < TOTAL_PER_GAME-1){
    game.index++;
    renderQuestion();
  } else {
    finishGame();
  }
}

function prev(){
  if(!game) return;
  if(game.index > 0){
    game.index--;
    renderQuestion();
  }
}

function finishGame(){
  if(!game || game.finished) return;
  stopTimer();
  game.endAt = Date.now();
  game.finished = true;

  const st = stats();
  const score10 = Math.round((st.good / TOTAL_PER_GAME) * 10 * 100) / 100;

  rGood.textContent = st.good;
  rBad.textContent  = st.bad;
  rScore.textContent= score10;

  const totalSec = Math.round((game.endAt - game.startAt)/1000);
  const mm = Math.floor(totalSec/60), ss = totalSec%60;
  resultTime.textContent = "Thời gian: " + mm + "m " + ss + "s";

  btnStop.disabled = true;
  reviewMode = false;
  if(btnExitReview) btnExitReview.style.display = "none";
  show(screenResult);
  renderStats();
  if(exportNote) exportNote.style.display = "";
}


function _safeFilename(s){
  try{
    return (s||"").toString()
      .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
      .replace(/[^a-zA-Z0-9]+/g,"_")
      .replace(/^_+|_+$/g,"")
      .slice(0,40) || "HocSinh";
  }catch(e){
    return "HocSinh";
  }
}
function _htmlToText(s){
  return (s||"").toString()
    .replace(/<img[^>]*>/gi,"[CT]")
    .replace(/<br\s*\/?>/gi,"\n")
    .replace(/<\/p>/gi,"\n")
    .replace(/<[^>]*>/g,"")
    .replace(/&nbsp;/g," ")
    .replace(/&amp;/g,"&")
    .replace(/\n{3,}/g,"\n\n")
    .replace(/[ \t]{2,}/g," ")
    .trim();
}
function exportExcel(){
  if(!game || !game.finished) return;
  const st = stats();
  const score10 = Math.round((st.good / TOTAL_PER_GAME) * 10 * 100) / 100;
  const totalSec = Math.round((game.endAt - game.startAt)/1000);

  const now = new Date(game.endAt || Date.now());
  const stamp = now.toISOString().slice(0,19).replace(/[:T]/g,"-");
  const fn = `Ket_qua_on_tap_nguyen_ham_${_safeFilename(game.playerName)}_${_safeFilename(game.playerClass)}_${stamp}.xlsx`;

  if(window.XLSX){
    const summaryAOA = [
      ["ÔN TẬP NGUYÊN HÀM - TẠO BỞI MR SANG"],
      ["Họ và tên", game.playerName || ""],
      ["Lớp", game.playerClass || ""],
      ["Bắt đầu", new Date(game.startAt).toLocaleString("vi-VN")],
      ["Kết thúc", new Date(game.endAt).toLocaleString("vi-VN")],
      ["Thời gian làm (giây)", totalSec],
      ["Số câu", TOTAL_PER_GAME],
      ["Đúng", st.good],
      ["Sai", st.bad],
      ["Điểm (10)", score10],
    ];
    const ws1 = XLSX.utils.aoa_to_sheet(summaryAOA);

    const header = ["STT","ID","Câu hỏi","A","B","C","D","Đáp án đúng","Đã chọn","Kết quả","Thời gian (giây)"];
    const rows = [header];
    for(let i=0;i<game.items.length;i++){
      const it = game.items[i];
      const chosen = (it.chosen===null) ? "" : it.chosen;
      const result = (chosen===it.correct) ? "Đúng" : "Sai";
      const spent = (typeof it.spent === "number") ? Math.round(it.spent) : "";
      rows.push([
        i+1,
        it.id,
        _htmlToText(it.q),
        _htmlToText(it.options.A),
        _htmlToText(it.options.B),
        _htmlToText(it.options.C),
        _htmlToText(it.options.D),
        it.correct,
        chosen,
        result,
        spent
      ]);
    }
    const ws2 = XLSX.utils.aoa_to_sheet(rows);

    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws1, "Tong_quan");
    XLSX.utils.book_append_sheet(wb, ws2, "Chi_tiet");
    XLSX.writeFile(wb, fn);
  } else {
    alert("Thiếu thư viện XLSX (cần Internet để tải). Anh/chị thử mở lại khi có mạng, hoặc dùng file CSV thay thế.");
  }
}

function startNewGame(name, cls){
  game = buildGame();
  reviewMode = false;
  if(btnExitReview) btnExitReview.style.display = "none";
  game.playerName = name;
  game.playerClass = cls;
  show(screenGame);
  if(exportNote) exportNote.style.display = "none";
  btnStop.disabled = false;
  renderQuestion();
  startTimer();
}

btnStart.addEventListener("click", ()=>{
  const name = (playerName?.value || "").trim();
  const cls  = (playerClass?.value || "").trim();
  if(!name || !cls){
    if(playerWarn) playerWarn.style.display = "";
    if(!name && playerName) playerName.focus();
    else if(playerClass) playerClass.focus();
    return;
  }
  if(playerWarn) playerWarn.style.display = "none";


  if(audioOn) beep(440, 20); // unlock audio
  stopIntro();
  startNewGame(name, cls);
});

btnHow.addEventListener("click", ()=>{
  howText.style.display = (howText.style.display==="none") ? "" : "none";
  howText.textContent = "Chọn 1 đáp án (A–D). Sau khi chấm, đáp án đúng sẽ được tô xanh. Hết 30 giây mà chưa chọn thì tính sai.";
});

btnPrev.addEventListener("click", prev);
btnNext.addEventListener("click", next);

btnStop.addEventListener("click", ()=>{
  if(!game) return;
  finishGame();
});

btnMute.addEventListener("click", ()=>{
  audioOn = !audioOn;
  btnMute.textContent = audioOn ? "Tắt âm" : "Bật âm";
  if(audioOn) beep(660, 40);
});

btnExit.addEventListener("click", ()=>{
  const ok = confirm("Bạn muốn thoát? Tiến trình hiện tại sẽ không được tính.");
  if(!ok) return;
  stopTimer();
  stopIntro();
  game = null;
  reviewMode = false;
  if(btnExitReview) btnExitReview.style.display = "none";
  show(screenStart);
});


btnReplay.addEventListener("click", ()=>{
  // dùng lại thông tin học sinh của lượt vừa rồi (hoặc từ ô nhập)
  const name = (game && game.playerName) ? game.playerName : ((playerName?.value||"").trim());
  const cls  = (game && game.playerClass) ? game.playerClass : ((playerClass?.value||"").trim());
  startNewGame(name || "—", cls || "—");
  reviewNote.style.display = "none";
});

btnExport && btnExport.addEventListener("click", exportExcel);

btnReview.addEventListener("click", ()=>{
  if(!game) return;
  reviewMode = true;
  if(btnExitReview) btnExitReview.style.display = "";
  show(screenGame);
  reviewNote.style.display = "";
  stopTimer();
  renderQuestion();
  qTimer.textContent = "Xem lại";
  timeBar.style.width = "100%";
  navHint.textContent = "Chế độ xem lại: bấm ↩ Trở lại kết quả để thoát.";
});

btnExitReview && btnExitReview.addEventListener("click", ()=>{
  // Thoát chế độ xem lại
  reviewMode = false;
  if(btnExitReview) btnExitReview.style.display = "none";
  if(reviewNote) reviewNote.style.display = "none";
  show(screenResult);
});

// init
show(screenStart);
// Thử phát intro (có thể bị chặn trên mobile nếu chưa tương tác)
setTimeout(()=>{ ensureIntro(); }, 300);

renderStats();
</script>
</body>
</html>
